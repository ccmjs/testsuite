"use strict";(()=>{const component={name:"testsuite",ccm:"https://ccmjs.github.io/testsuite/versions/v4/libs/ccm/ccm.min.js",config:{css:["ccm.load","https://ccmjs.github.io/testsuite/versions/v4/resources/styles.min.css"],helper:["ccm.load",{url:"https://ccmjs.github.io/testsuite/versions/v4/libs/ccm/helper.min.js",type:"module"}],html:["ccm.load","https://ccmjs.github.io/testsuite/versions/v4/resources/templates.html"],onfinish:{log:true},tests:["ccm.load","https://ccmjs.github.io/testsuite/versions/v4/resources/tests.min.js"]},Instance:function(){let $;const setups=[];const finallies=[];let results;this.ready=async()=>{$=Object.assign({},this.ccm.helper,this.helper);$.use(this.ccm);if(!this.package)return;const array=this.package.split(".");while(array.length>0){if(this.tests.setup)setups.push(this.tests.setup);if(this.tests.finally)finallies.unshift(this.tests.finally);this.tests=this.tests[array.shift()]}};this.start=async()=>{const self=this;results={executed:0,passed:0,failed:0,details:{}};let main_elem,packages_elem,test_elem,table_elem,result_elem;if(self.element){main_elem=$.html(self.html.main);packages_elem=main_elem.querySelector("#packages");$.setContent(self.element,main_elem)}await processPackage(self.package,self.tests,setups,finallies);await $.onFinish(self);async function processPackage(package_path="",package_obj={},setups,finallies){if(package_obj.setup){setups=setups.slice();setups.push(package_obj.setup)}if(package_obj.finally){finallies=finallies.slice();finallies.unshift(package_obj.finally)}package_obj.tests&&await runPackageTests(package_obj.tests);delete package_obj.setup;delete package_obj.tests;delete package_obj.finally;for(const key in package_obj){const subpackage=package_obj[key];delete package_obj[key];await processPackage((package_path?package_path+".":"")+key,subpackage,setups,finallies)}async function runPackageTests(tests){if(self.element){const package_elem=$.html(self.html.package,package_path);table_elem=package_elem.querySelector(".table");packages_elem.appendChild(package_elem)}await $.asyncForEach(Object.keys(tests).map((key=>tests[key])),(async test=>{if(self.element){main_elem.querySelector("#executed").appendChild($.loading(self));test_elem=$.html(self.html.test,test.name);table_elem.appendChild(test_elem);result_elem=test_elem.querySelector(".result");result_elem.appendChild($.loading(self))}const suite={ccm:self.ccm,passed:()=>setResult(true),failed:message=>{setResult(false,message)},assertTrue:condition=>setResult(!!condition),assertFalse:condition=>setResult(!condition),assertSame:(expected,actual)=>{setResult(expected==actual,{expected:expected,actual:actual})},assertEquals:(expected,actual,delta)=>{if(typeof expected==="object")expected=JSON.stringify(expected);if(typeof actual==="object")actual=JSON.stringify(actual);setResult(delta?Math.abs(expected-actual)<delta:expected===actual,{expected:expected,actual:actual})},assertNotSame:(expected,actual)=>setResult(expected!==actual),assertNotEquals:(expected,actual)=>suite.assertNotSame(JSON.stringify(expected),JSON.stringify(actual))};await $.asyncForEach(setups,(async setup=>setup(suite)));results.executed++;try{await test(suite)}catch(e){!suite.abort&&setResult(false,e.name+(e.message?": "+e.message:""))}showResult();if(self.element){main_elem.querySelector("#executed").innerHTML=results.executed.toString();main_elem.querySelector("#passed").innerHTML=results.passed.toString();main_elem.querySelector("#failed").innerHTML=results.failed.toString()}await $.asyncForEach(finallies,(final=>final(suite)));function setResult(result,message){if(suite.abort)return;suite.result=result;if(result)return;suite.abort=true;if(!message)return;if(typeof message==="string")suite.message=message;else{suite.expected=message.expected;suite.actual=message.actual}}function showResult(){const value=suite.result?"passed":"failed";suite.result?results.passed++:results.failed++;self.element&&$.setContent(result_elem,$.html(self.html.result,{value:value}));results.details[package_path+"."+test.name]=suite.result;if(suite.message){if(self.element)test_elem.appendChild($.html(self.html.message,suite.message));results.details[package_path+"."+test.name]=suite.message}if(!suite.result&&suite.expected!==undefined&&suite.actual!==undefined){if(self.element){if(typeof suite.expected==="object")suite.expected=$.stringify(suite.expected);suite.expected=$.escapeHTML(suite.expected);if(typeof suite.actual==="object")suite.actual=$.stringify(suite.actual);suite.actual=$.escapeHTML(suite.actual);test_elem.appendChild($.html(self.html.comparison,suite.expected,suite.actual))}results.details[package_path+"."+test.name]={expected:suite.expected,actual:suite.actual}}}}))}}};this.getValue=()=>$.clone(results)}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||[""])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){(c="latest"?window.ccm:window.ccm[c]).component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();
//# sourceMappingURL=ccm.testsuite.min.js.map